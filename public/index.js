const qS=document.querySelector.bind(document),wl=window.location.origin,uploadInput=qS("#hidden-upload"),adminPasswordInput=qS("#admin-password"),passwordInput=qS("#password"),errorDiv=qS("#error-div"),errorMessage=qS("#error-message");function displayError(e,t){e?(errorDiv.style.display="block",qS("#error-title").innerText=e,t&&(errorMessage.innerText=t)):errorDiv.style.display="none"}function dlcfg(){var e=document.createElement("script");e.src="dl.js",document.body.appendChild(e)}function getFiles(){let e=adminPasswordInput.value||"invalid";qS("#files-response-container").innerHTML="",fetch("/files/"+e).then(e=>{displayError();let t=e.status;200===t?e.json().then(e=>{if(e instanceof Array){e=e.sort((e,t)=>t.UDate-e.UDate);for(let t=0;t<e.length;t++)appendFile("files-response-container",{filename:e[t].Name,date:e[t].UDate,url:`${wl}/${e[t].Name}`,deletionUrl:`${wl}/${e[t].Name}/delete/${e[t].EditKey}`,subtext:`${e[t].Views} views`})}}):401===t?displayError("Unauthorized","The admin password you entered was invalid."):displayError(`Error ${t}`,"An error occurred while trying to get the files.")})}function appendFile(e,t){let r=document.getElementById(e),n=document.createElement("div");n.className="item",d=new Date(1e3*t.date).toLocaleString(),n.innerHTML=`<div class="right floated content"><div class="ui button inverted" onclick="navigator.clipboard.writeText('${t.url}')">Copy URL</div><a href="${t.deletionUrl}" target="_blank"><div class="ui button red inverted">Delete</div></a></div><i class="icon">ðŸ“„</i><div class="content"><a href="${t.url}">${t.filename}<br><span class="subtext">${t.subtext} (${d})</span></div>`,r.appendChild(n)}function upload(){let e=uploadInput.files,t=passwordInput.value;for(let r=0;r<e.length;r++){let n=e[r],i=new FormData;i.append("file",n),i.append("password",t),fetch("/upload",{method:"POST",body:i}).then(e=>{displayError();let t=e.status;e.json().then(e=>{200===t?appendFile("upload-response-container",{subtext:`${e.size} bytes`,...e}):401===t?displayError("Unauthorized","The password you entered was invalid."):e.error?displayError(`Error ${t}`,e.error):displayError(`Error ${t}`,"Unknown Error")})})}uploadInput.value=""}uploadInput.addEventListener("change",upload),qS("#display-files").addEventListener("click",getFiles);var lastTarget=null;function isFile(e){for(var t=e.dataTransfer,r=0;r<t.types.length;r++)if("Files"===t.types[r])return!0;return!1}window.addEventListener("dragenter",function(e){isFile(e)&&(lastTarget=e.target,qS("#dropzone").style.visibility="",qS("#dropzone").style.opacity=1,qS("#textnode").style.fontSize="48px")}),window.addEventListener("dragleave",function(e){e.preventDefault(),e.target!==lastTarget&&e.target!==document||(qS("#dropzone").style.visibility="hidden",qS("#dropzone").style.opacity=0,qS("#textnode").style.fontSize="42px")}),window.addEventListener("dragover",function(e){e.preventDefault()}),window.addEventListener("drop",function(e){e.preventDefault(),qS("#dropzone").style.visibility="hidden",qS("#dropzone").style.opacity=0,qS("#textnode").style.fontSize="42px",0<e.dataTransfer.files.length&&(document.getElementById("hidden-upload").files=e.dataTransfer.files,upload())});